{% extends "base_anonymizer.html" %}
{% block content %}
<div class="card">
    <h2>ðŸ”’ Text Anonymization</h2>

    <form id="anonymize-form"
          hx-post="{{ url_for('anonymize_web.process_text') }}"
          hx-target="#result-container"
          hx-swap="innerHTML"
          hx-trigger="submit"
          hx-indicator="#loading-spinner"
          class="form">

        <label for="input-text">Paste text to anonymize:</label>
        <textarea id="input-text" name="text" rows="6"
                  placeholder="Enter or paste textâ€¦" required
                  class="w100"></textarea>

        <fieldset class="algorithm-selector" style="margin-top:1rem;">
            <legend>Choose anonymization algorithm:</legend>
            <label style="margin-right:1rem;">
                <input type="radio" name="algorithm" value="fast" checked>
                Fast Masking
            </label>
            <label style="margin-right:1rem;">
                <input type="radio" name="algorithm" value="genai">
                GenAI Anonymisation
            </label>
            <label>
                <input type="radio" name="algorithm" value="priv">
                Priv Masker
            </label>
        </fieldset>

        <div class="form-actions">
            <button type="submit" class="btn primary">ðŸš€ Anonymize</button>
            <span id="loading-spinner" class="spinner hidden"></span>
        </div>
    </form>
</div>

<!-- 1ï¸âƒ£  Fixed result panel (original placeholder) -->
<div id="result-container" class="card" style="margin-top: 1rem;">
    <h3>âœ… Anonymized Text</h3>
    <p class="muted">The result will appear after anonymization.</p>
</div>

{% raw %}
<script>
    // Simple spinner
    document.body.addEventListener('htmx:request', () => {
        document.getElementById('loading-spinner').classList.remove('hidden');
    });
    document.body.addEventListener('htmx:afterRequest', () => {
        document.getElementById('loading-spinner').classList.add('hidden');
        highlightTags();  // highlight tags after receiving the result
    });

    // Function that highlights all {{TAG}} occurrences in the returned text
    function highlightTags() {
        const pre = document.getElementById('anonymized-result');
        if (!pre) return;   // no result has been returned yet

        // Replace every {{...}} with <span class="tag-highlight">{{...}}</span>
        const html = pre.innerHTML.replace(/(\{\{[^}]+\}\})/g,
            '<span class="tag-highlight">$1</span>');
        pre.innerHTML = html;
    }
</script>
{% endraw %}

{% endblock %}